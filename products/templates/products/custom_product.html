{% extends "base.html" %}
{% load static %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="overlay"></div>
    <div class="container-fluid">
        <div class="row">
            <div class="col text-center mt-3">
                <h2 class="logo-font">Customize Your Drone</h2>
                <hr class="w-50 mb-1">
            </div>
        </div>

        <div class="row">
            <!-- Image Section on the left -->
            <div class="col-12 col-md-6">
                <div class="image-preview">
                    <img id="drone-image" class="card-img-top img-fluid" src="{% static 'custom1-black.webp' %}" alt="Custom Drone">
                </div>
            </div>

            <!-- Customization options on the right -->
            <div class="col-12 col-md-6">
                <div class="customization-container custom-margin">
                    <!-- Drone Type Selection -->
                    <label for="drone-type" class="form-label">Drone Type:</label>
                    <select id="drone-type" name="drone_type" class="form-control mb-3">
                        <option value="custom1">Falcon X</option>
                        <option value="custom2">Sky Hawk</option>
                        <option value="custom3">Phantom Vortex</option>
                    </select>

                    <!-- Color Selection -->
                    <div class="d-flex align-items-center justify-content-center my-3 color-selector-wrapper">
                        <div class="arrow arrow-left" id="left-arrow">
                            <i class="fas fa-chevron-left"></i>
                        </div>

                        <div class="color-selector d-flex justify-content-center mx-3 flex-wrap" id="color-carousel">
                            <label class="color-option" style="background-color: black;">
                                <input type="radio" name="color" value="black" checked>
                            </label>
                            <label class="color-option" style="background-color: white;">
                                <input type="radio" name="color" value="white">
                            </label>
                            <label class="color-option" style="background-color: blue;">
                                <input type="radio" name="color" value="blue">
                            </label>
                            <label class="color-option" style="background-color: green;">
                                <input type="radio" name="color" value="green">
                            </label>
                            <label class="color-option" style="background-color: pink;">
                                <input type="radio" name="color" value="pink">
                            </label>
                            <label class="color-option" style="background-color: purple;">
                                <input type="radio" name="color" value="purple">
                            </label>
                            <label class="color-option" style="background-color: red;">
                                <input type="radio" name="color" value="red">
                            </label>
                            <label class="color-option" style="background-color: yellow;">
                                <input type="radio" name="color" value="yellow">
                            </label>
                            <label class="color-option" style="background-color: orange;">
                                <input type="radio" name="color" value="orange">
                            </label>
                        </div>

                        <div class="arrow arrow-right" id="right-arrow">
                            <i class="fas fa-chevron-right"></i>
                        </div>
                    </div>

                    <!-- Add Attachments -->
                    <div class="attachments mt-4">
                        <label class="form-label">Attachments:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="attachments" value="camera" id="camera">
                            <label class="form-check-label" for="camera">Advanced Camera (+ $299)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="attachments" value="vr-goggles" id="vr-goggles">
                            <label class="form-check-label" for="vr-goggles">VR Goggles (+ $199)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="attachments" value="carry-case" id="carry-case">
                            <label class="form-check-label" for="carry-case">Carry Case (+ $49)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="attachments" value="extra-battery" id="extra-battery">
                            <label class="form-check-label" for="extra-battery">Extra Battery (+ $99)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="attachments" value="extra-propellers" id="extra-propellers">
                            <label class="form-check-label" for="extra-propellers">Extra Propellers (+ $29)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" name="attachments" value="insurance" id="insurance">
                            <label class="form-check-label" for="insurance">Insurance (+ $149)</label>
                        </div>
                    </div>

                    <!-- Add to Bag Form -->
                    <form class="form mt-5" action="{% url 'add_custom_drone_to_bag' %}" method="POST">
                        {% csrf_token %}
                        <input type="hidden" name="sku" id="selected-drone-sku" value="falcon-x-10001-black">
                        <input type="hidden" name="quantity" value="1">

                        <!-- Add to Bag Button -->
                        <div class="col-12">
                            <a href="{% url 'products' %}" class="btn btn-outline-black rounded-0">
                                <span class="icon"><i class="fas fa-chevron-left"></i></span>
                                <span class="text-uppercase">Keep Shopping</span>
                            </a>
                            <input type="submit" class="btn btn-black rounded-0 text-uppercase" value="Add to Bag">
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript for Dynamic Image Updates and Attachments -->
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function() {
            const droneImage = document.getElementById('drone-image');
            const droneTypeSelect = document.getElementById('drone-type');
            const colorOptions = document.querySelectorAll('input[name="color"]');
            const selectedSkuInput = document.getElementById('selected-drone-sku');
            const leftArrow = document.getElementById('left-arrow');
            const rightArrow = document.getElementById('right-arrow');
            let currentColorIndex = 0;

            const colorItems = Array.from(document.querySelectorAll('.color-option'));

            function updateDroneImage() {
                const selectedType = droneTypeSelect.value; // 'custom1', 'custom2', or 'custom3'
                const selectedColor = document.querySelector('input[name="color"]:checked').value; // color selected by user

                // Set SKU based on selection
                const skuMap = {
                    'custom1': 'falcon-x-10001',
                    'custom2': 'sky-hawk-10002',
                    'custom3': 'phantom-vortex-10003'
                };
                const selectedSku = skuMap[selectedType];

                selectedSkuInput.value = `${selectedSku}-${selectedColor}`; // Set SKU for the hidden input

                // Construct the image URL based on the type and color
                const newImageUrl = `/media/${selectedType}-${selectedColor}.webp`;
                droneImage.src = newImageUrl; // Update image source

                colorItems.forEach(item => item.classList.remove('active'));
                colorItems[currentColorIndex].classList.add('active');
            }

            colorOptions.forEach(option => {
                option.addEventListener('change', updateDroneImage);
            });

            droneTypeSelect.addEventListener('change', updateDroneImage);

            leftArrow.addEventListener('click', function() {
                currentColorIndex = (currentColorIndex === 0) ? colorItems.length - 1 : currentColorIndex - 1;
                colorItems[currentColorIndex].querySelector('input[type="radio"]').checked = true;
                updateDroneImage();
            });

            rightArrow.addEventListener('click', function() {
                currentColorIndex = (currentColorIndex === colorItems.length - 1) ? 0 : currentColorIndex + 1;
                colorItems[currentColorIndex].querySelector('input[type="radio"]').checked = true;
                updateDroneImage();
            });

            updateDroneImage(); // Initialize the image on page load
        });
    </script>
{% endblock %}
